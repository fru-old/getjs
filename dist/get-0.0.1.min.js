(function(x,y){function t(m,q){var n=m.replace(/\/index$/,"");n!==m&&(z[n]=m);v[m]=v[n]=q}function A(m){if(!w[m]){var q="Could not load module: '"+m+"'";if(!v[m])throw Error(q);q={exports:w[m]={}};v[m](function(n){var b=z[m]||m,l=/(\.?\.\/?)*/.exec(n)[0],h=Math.floor(l.replace(/\//g,"").length/1.9+0.99);h&&(b=b.split("/"),b=b.slice(0,b.length-h),(b=b.join("/"))&&(n=b+"/"+n.slice(l.length)));n=n.replace(/\/$/,"");return A(n)},q.exports,q);w[m]=q.exports}return w[m]}function u(){}var w={},v={},z={};
t("src/curry",function(m,q,n){function b(h,p){var f=!1,a=function(){var a=Array.prototype.slice.call(arguments,0),e=this,c=[],r=!1;if(!f){for(var g=0;g<a.length;g++)l.equals(a[g])&&c.push(g);r=l.equals(a[a.length-1])}return 0===c.length||f?h.apply(e,a):b(function(){var g=Array.prototype.slice.call(arguments,0),k=c.length-(r?1:0);if(g.length<k)throw Error("Expect at least "+k+" arguments.");r&&a.pop();for(var b=0;b<g.length;b++)b<k?a[c[b]]=g[b]:a.push(g[b]);return h.apply(e,a)},!0)};a.uncurry=function(){if(!p)throw"Uncurry disabled.";
f=!0;return this};return a}var l=(x._||(x._={})).runid={equals:function(b){return b&&this===b.runid}};n.exports=b});u.define=t;u.require=A;"undefined"===typeof exports?window.get=u:module.exports=u;t("src/node",function(m,q,n){function b(c,a,g){this.children=a||new d.Array;this.nodedata=c||new b.DefaultData;this.timestamp=0;this.pending=[];this.detached=g||!1;this.creation=e.ascending()}function l(c){var a=0,g=this;this.start=function(){a++};this.close=function(){0<a&&a--;0===a&&(a=-1,c&&c())};this.branch=
function(c){var a=new l(function(){c&&c();g.close()});this.start();a.expired=this.expired;return a};this.expired=function(){return 0>a}}function h(c,r,g,s){s=new l(s);s.start();if(c.timestamp<g){c.timestamp=g;var k=new a(c,g,s);(r=r(k,c))&&c.pending.push({timestamp:g,operation:r})}s.close()}function p(c,a,g,s){(function B(d){var b=c.pending[d]||{},e=b.timestamp>g;c.pending.length<=d||e?s():h(a,b.operation,b.timestamp,function(){B(d+1)})})(0)}function f(){throw Error("This reference has expired.");
}function a(c,d,g){this.clone=function(){function a(c,g){var e=!d;g.cloned=!0;e=new b(g.nodedata,g.children,e);e.pending=g.pending;e.cloned=!0;d=e;return a}g.expired()&&f();var d;h(c,a,e.ascending(),function(){});return new Root(d)};this.isRoot=function(){g.expired()&&f();return c.detached};this.isInfinite=function(){g.expired()&&f();return!!(c.children||{}).infinite};this.set=function(a,d,e){g.expired()&&f();if(!c.nodedata[a])throw Error("Unknown type.");return c.nodedata[a].set(d,e)};this.get=function(a,
d){g.expired()&&f();if(!c.nodedata[a])throw Error("Unknown type.");return c.nodedata[a].get(d)};this.all=function(a){g.expired()&&f();if(!c.nodedata[a])throw Error("Unknown type.");return c.nodedata[a].clone(!0)};this.next=function(e,b,h,l){g.expired()&&f();g.start();var m,n,q=g.branch(function(){l&&l(m,n);g.close()});q.start();c.children.next(e,b,function(g,e,b,k){k||g?(m=g,n=k,q.close()):p(c,b,d,function(){h(new a(b,d,q),e);q.close()})})};this.find=function(e,b,h,l){g.expired()&&f();if(this.isInfinite())l&&
l(null,{length:0});else{g.start();var m,n,q=g.branch(function(){l&&l(m,n);g.close()});q.start();(function C(g){c.children.next(g,b,function(g,e,b,k){k||g?(m=g,n=k,q.close()):p(c,b,d,function(){h(new a(b,d,q),e);C(e+1)})})})(e)}}}var d=m("./stream"),e={current:1,ascending:function(){return e.current++}};b.prototype.onchange=function(){if(this.cloned){var a={},d;for(d in this.nodedata)a[d]=this.nodedata[d].clone();for(var g in this.pending);this.nodedata=a;this.cloned=!1}};b.KeyValue=function(a){var d=
a||{};this.set=function(a,c){return d[a]=c};this.get=function(a){return d[a]};this.clone=function(a){var c={},e;for(e in d)c[e]=d[e];return a?c:new b.KeyValue(c)}};b.DefaultData=function(){this.attr=new b.KeyValue;this.prop=new b.KeyValue;this.path=new b.KeyValue;this.tags=new b.KeyValue;this.text=new b.KeyValue;this.mark=new b.KeyValue};b.Root=function(a){a.detached=!0;this.execute=function(d,g){a.detached||f();h(a,d,e.ascending(),g)}};n.exports=b});t("src/parse",function(m,q,n){function b(b){this.original=
b}b.tokenize=function(l,h){var p=0;return new b(l.match(h).map(function(b){var a={data:b,pos:p,assert:function(a,e){var c=this.data;if("name"===a){if(c.name||-1==="#:[]=!<>.*{}".indexOf(c[0]))return!0}else if(c===a)return!0;if(e)return!1;throw Error(['Unexpected symbol "'+c+'" ','expected "'+a+'" ',"at column: "+this.pos].join(""));}};p+=b.length;return a}))};b.prototype.parse=function(l){var h,p=0,f=new b(this.original.map(function(a,d){if(!a)return a;var e=!1,c=l.call({setState:function(a){p=a},
setCurrent:function(a){h=a},remove:function(){e=!0},expected:function(c,g){return a.assert(c,g)}},a.data,p,h);return e?null:{data:c,pos:a.pos,assert:a.assert}}));if(0<p)throw Error("Unexpected ending.");return f};n.exports=function(l){var h=[[]];b.tokenize(l,/\#|\:|\[|\]|[\=\!<>]+|\{|\}|\*+|\.|[^\#\:\[\]\=\!<>\{\}\*\.]+/g).parse(function(b,f,a){var d;switch(f){case 0:if("*"===b[0]){d={wildcard:b.length};break}else if(this.expected("name",!0)){d={constant:b};break}else if("{"===b)this.setState(1);
else return this.setCurrent(null),b;break;case 1:this.expected("{");this.setState(2);break;case 2:this.expected("name");d={breakets:b};this.setState(3);break;case 3:this.expected("}");this.setState(4);break;case 4:this.expected("}"),this.setState(0)}if(a)this.remove(),d&&a.push(d);else return this.setCurrent(a=d?[d]:[]),{name:a}}).parse(function(b,f,a){var d;switch(f){case -1:if("["===b){this.setState(3);break}case 0:if(b.name)d={type:"_",name:b.name};else{switch(b){case ".":return b;case "#":this.setState(1);
break;case ":":this.setState(2);break;case "[":this.setState(3);break;default:this.expected("#, : or [")}d={type:b}}break;case 1:case 2:this.expected("name");a.name=b.name;this.setState(1===f?0:-1);break;case 3:this.expected("name");a.prop=b.name;this.setState(4);break;case 4:-1!=="=!<>".indexOf(b[0])?(a.assert=b,this.setState(5)):(this.expected("]"),this.setState(0));break;case 5:this.expected("name");a.value=b.name;this.setState(6);break;case 6:this.expected("]"),this.setState(0)}if(d)return this.setCurrent(d),
d;this.remove()}).parse(function(b){"."===b?h.push([]):h[h.length-1].push(b)});return h}});t("src/query",function(m,q,n){function b(){this.root=this.traces=[]}function l(a,b,e,c,r){var g;switch(e){case "==":case "===":g=function(a,c){return a==c};break;case "!=":case "!==":g=function(a,c){return a!=c};break;case "<":g=function(a,c){return a<+c};break;case "<=":g=function(a,c){return a<=+c};break;case ">":g=function(a,c){return a>+c};break;case ">=":g=function(a,c){return a>=+c};break;case null:g=
function(a,c){return a!==y};break;default:throw Error("Unknown operator "+e);}e=1===c.length&&c[0].breakets?r(c[0].breakets):e?h(c,r):null;return new f.Assertion(a,b,g,e)}function h(a,b){var e="",c;for(c in a)if(a[c].breakets)e+=b(a[c].breakets);else if(a[c].constant)e+=a[c].constant;else if(a[c].wildcard)throw Error("* not supported here.");return e}function p(a,b){var e=[];a.map(function(a){if("_"===(a[0]||{}).type&&1===(a[0].name||{}).wildcard)e.push(f.Assertion.truthy);else{var b,g,d=null,k;switch(a.type){case "_":b=
"tags",g="name",d="==",k=a.name}e.push(l(b,g,d,k))}});return new f.DNF(e)}m("./parse");var f=m("./state");b.buildStateMachine=function(a,b){var e;a.map(function(a){var b=new f.States;a.map(function(a,c){if(1===a.length&&"_"===(a[0]||{}).type&&2===(a[0].name||{}).wildcard){var d=f.Assertion.truthy;b.addTransition(c,c+1,d);b.addTransition(c,c,d)}else d=p(a),b.addTransition(c,c+1,d)});b.setEndState(a.length);e?e.or(b):e=new f.DNF([b])});return e};b.prototype.get=function(){};b.prototype.has=function(){};
b.prototype.from=function(){};b.prototype.each=function(){};b.prototype.live=function(){};n.exports=b});t("src/state",function(m,q,n){function b(b,f){this.terms=[{truthy:b||[],falsey:f||[]}]}function l(b,f,a,d){this.resolve=function(e){return a(d,e.get(b,f))}}function h(b,f,a){b=b||[0];f=f||{};a=a||{};this.addTransition=function(a,b,c){f[a]||(f[a]=[]);f[a].push({next:b,dnfa:c})};this.setEndState=function(b){a[b]=!0};this.resolve=function(){for(var d=0;d<b.length;d++)if(a[b[d]])return!0;return!1};
this.transition=function(d){if(0===b.length)return this;for(var e={},c=[],r=0;r<b.length;r++)for(var g=f[b[r]]||[],s=0;s<g.length;s++)if(g[s].dnfa.resolve(d)){var k=g[s].next;e[k]||(e[k]=!0,c.push(k))}return new h(c,f,a)}}b.prototype.or=function(h){h instanceof b||(h=new b([h]));this.terms=this.terms.concat(h.terms);return this};l.truthy={resolve:function(){return!0}};b.prototype.resolve=function(b){for(var f=!1,a=0;a<this.terms.length;a++){for(var d=!0,e=this.terms[a].truthy,c=this.terms[a].falsey,
r=0;r<e.length;r++)d&=e[r].resolve(b);for(e=0;e<c.length;e++)d&=!c[e].resolve(b);d&&(f=!0)}return f};b.prototype.transition=function(h){function f(a){for(var b=[],d=0;d<a.length;d++)b[d]=a[d].transition(h);return b}for(var a=new b,d=0;d<this.terms.length;d++)a.terms[d]={truthy:f(this.terms[d].truthy),falsey:f(this.terms[d].falsey)};return a};n.exports.States=h;n.exports.DNF=b;n.exports.Assertion=l});t("src/static",function(m,q,n){function b(a,b){for(var d in a)a.hasOwnProperty(d)&&b(d,a[d],!1)}function l(a){return"string"!==
typeof a&&"number"===typeof a.length}function h(a,b,d,e){for(var k=0;k<a.length;k++){var f=b.slice(0);f.push(k);d&&l(a[k])?h(a[k],f,d,e):e(f,a[k],!0)}}function p(a,f){function g(a,b,c){var d=p(b);d?(d.nodedata.tags.set(c?"index":"name",a),k.push(d)):s.prop.set(a,b)}var s=new e.DefaultData,k=[];if(l(a))s.tags.set("array",!0),h(a,[],f,g);else if(a.constructor===Object)b(a,g);else return null;return new e(s,new d.Array(k))}function f(a,b,d,e){function f(a){h.length<=a+1?d[h[a]]=b:(d[h[a]]=[],f(a+1))}
var h=a.get("tags","index");h&&"number"===typeof h[0]?f(0):e.push(b)}function a(b,d){var e=b.get("tags","array"),h=[],k=e?[]:{};b.find(0,null,function(b){a(b,function(a){if(e)f(b,a,k,h);else{var d=k,c=b.get("tags","name");c?d[c]=a:h.push(a)}})},function(){e&&(k=k.concat(h));var a=b.all("prop"),f;for(f in a)k[f]=a[f];d(k)})}var d=m("./stream"),e=m("./node");n.exports=function(b){b.read=function(a,b){b||(b={});var d=b.type?b.type.toLowerCase():"";if(!d||"js"===d){d=p(a,!!b.flatten);if(!d)throw Error("Expected toplevel array or object.");
return new e.Root(d)}};b.toJS=function(b,d){b.execute(function(b){a(b,function(a){d(a)})})}}});t("src/stream",function(m,q,n){function b(a){this.infinite=!!a}function l(a,b){this.original=a;this.extend=b}function h(a,b){this.original=a;this.stream=b}function p(a,b,e,c){this.reduced=new l(a,-b);this.count=e;this.fill=c}b.prototype.next=function(a,b,e){throw Error("Not implemented.");};b.Array=function(a){!a||a instanceof Array||(a=[a]);this.elements=a||[]};b.Array.prototype=new b;b.Array.prototype.next=
function(a,b,e){a>=this.elements.length?e(null,a,null,{length:this.elements.length}):(b=this.elements[a],this.mapper&&(b=this.mapper(b)),e(null,a,b))};l.prototype=new b;l.prototype.next=function(a,b,e){var c=this;this.original.next(a-this.extend,b,function(a,b,d,f){f&&(f.length+=c.extend);e(a,b+c.extend,d,f)})};(function(a,b){this.next=function(a,c,f){this.original.next(a,c,function(a,c,e,h){e&&b(e);f(a,c,e,h)})}}).prototype=new b;h.prototype=new b;h.prototype.next=function(a,b,e){var c=this;this.original.next(a,
b,function(f,g,h,k){if(f)return e(f);k?(c.offset||(c.offset=new l(c.stream,k.length)),c.offset.next(a,b,e)):e(f,g,h,null)})};p.prototype=new b;p.prototype.next=function(a,b,e){if(a>=this.count&&this.fill)return e(null,null,null,{length:this.count});var c=this;this.reduced.next(a,b,function(a,b,d,f){if(a)return e(a);(!f||c.fill)&&b>=c.count?e(a,null,null,{length:c.count}):c.fill&&f?e(a,b,y,null):e(a,b,d,f)})};var f=Number.POSITIVE_INFINITY;b.prototype.append=function(a){a instanceof b||(a=new b.Array(a));
return new h(this,a)};b.prototype.map=function(a){return new b.Mapper(this,a)};b.prototype.prepend=function(a,d){d instanceof b||(d=new b.Array(d));var e=new p(this,0,a,!0),c=new p(this,a,f);return new h(e,new h(d,c))};b.prototype.detach=function(a,b){var e=new p(this,0,a,!0),c=new p(this,a+b,f);return{target:new h(e,c),result:new p(this,a,b)}};n.exports=b});u.require("src/static")(u)})(Function("return this")());
