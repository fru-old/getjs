(function(x,y){function t(m,q){var n=m.replace(/\/index$/,"");n!==m&&(z[n]=m);v[m]=v[n]=q}function A(m){if(!w[m]){var q="Could not load module: '"+m+"'";if(!v[m])throw Error(q);q={exports:w[m]={}};v[m](function(n){var a=z[m]||m,k=/(\.?\.\/?)*/.exec(n)[0],h=Math.floor(k.replace(/\//g,"").length/1.9+0.99);h&&(a=a.split("/"),a=a.slice(0,a.length-h),(a=a.join("/"))&&(n=a+"/"+n.slice(k.length)));n=n.replace(/\/$/,"");return A(n)},q.exports,q);w[m]=q.exports}return w[m]}function u(){}var w={},v={},z={};
t("src/curry",function(m,q,n){function a(h,p){var g=!1,b=function(){var b=Array.prototype.slice.call(arguments,0),e=this,c=[],r=!1;if(!g){for(var f=0;f<b.length;f++)k.equals(b[f])&&c.push(f);r=k.equals(b[b.length-1])}return 0===c.length||g?h.apply(e,b):a(function(){var f=Array.prototype.slice.call(arguments,0),l=c.length-(r?1:0);if(f.length<l)throw Error("Expect at least "+l+" arguments.");r&&b.pop();for(var a=0;a<f.length;a++)a<l?b[c[a]]=f[a]:b.push(f[a]);return h.apply(e,b)},!0)};b.uncurry=function(){if(!p)throw"Uncurry disabled.";
g=!0;return this};return b}var k=(x._||(x._={})).runid={equals:function(a){return a&&this===a.runid}};n.exports=a});u.define=t;u.require=A;"undefined"===typeof exports?window.get=u:module.exports=u;t("src/newparse",function(m,q,n){window.querylang={start:0,ended:[1,2],context:{result:[[]],last:function(){},add:function(a){}},tokenize:{"[=!<>]+":{type:"operator",invalid:function(a){return!/^((===)|(!==)|(==)|(!==)|<|(<=)|>|(>=))$/.test(a)}},"[A-Za-z0-9]+":{type:"name"},"{{?":{type:"{"},"}}?":{type:"}"},
":|#|\\[|\\]|\\.|\\*\\*?":{type:function(a){return a}}},states:{"0,1,**":function(){this.result.push([{type:"_",name:[{wildcard:2}]}])},"0,2,*":function(){},"0,2,name":function(a){},"0,3,:":null,"0,4,#":null,"0,6,[":null,"2,3,:":null,"2,4,#":null,"2,6,[":null,"2,0,.":null,"1,0,.":function(){},"3,2,name":function(a){},"4,2,name":function(a){},"6,7,name":function(a){},"7,8,operator":function(a){},"7,2,]":null,"8,9,{":null,"11,9,{":null,"10,11,}":null,"9,10,name":function(a){},"8,11,name":function(a){},
"11,11,name":function(a){},"11,2,]":null}}});t("src/node",function(m,q,n){function a(c,b,f){this.children=b||new d.Array;this.nodedata=c||new a.DefaultData;this.timestamp=0;this.pending=[];this.detached=f||!1;this.creation=e.ascending()}function k(c){var b=0,f=this;this.start=function(){b++};this.close=function(){0<b&&b--;0===b&&(b=-1,c&&c())};this.branch=function(c){var b=new k(function(){c&&c();f.close()});this.start();b.expired=this.expired;return b};this.expired=function(){return 0>b}}function h(c,
a,f,s){s=new k(s);s.start();if(c.timestamp<f){c.timestamp=f;var l=new b(c,f,s);(a=a(l,c))&&c.pending.push({timestamp:f,operation:a})}s.close()}function p(c,b,f,a){(function B(d){var e=c.pending[d]||{},p=e.timestamp>f;c.pending.length<=d||p?a():h(b,e.operation,e.timestamp,function(){B(d+1)})})(0)}function g(){throw Error("This reference has expired.");}function b(c,d,f){this.clone=function(){function b(c,f){var e=!d;f.cloned=!0;e=new a(f.nodedata,f.children,e);e.pending=f.pending;e.cloned=!0;d=e;return b}
f.expired()&&g();var d;h(c,b,e.ascending(),function(){});return new Root(d)};this.isRoot=function(){f.expired()&&g();return c.detached};this.isInfinite=function(){f.expired()&&g();return!!(c.children||{}).infinite};this.set=function(b,a,d){f.expired()&&g();if(!c.nodedata[b])throw Error("Unknown type.");return c.nodedata[b].set(a,d)};this.get=function(b,a){f.expired()&&g();if(!c.nodedata[b])throw Error("Unknown type.");return c.nodedata[b].get(a)};this.all=function(b){f.expired()&&g();if(!c.nodedata[b])throw Error("Unknown type.");
return c.nodedata[b].clone(!0)};this.next=function(a,e,h,k){f.expired()&&g();f.start();var m,n,q=f.branch(function(){k&&k(m,n);f.close()});q.start();c.children.next(a,e,function(f,a,e,l){l||f?(m=f,n=l,q.close()):p(c,e,d,function(){h(new b(e,d,q),a);q.close()})})};this.find=function(a,e,h,k){f.expired()&&g();if(this.isInfinite())k&&k(null,{length:0});else{f.start();var m,n,q=f.branch(function(){k&&k(m,n);f.close()});q.start();(function C(f){c.children.next(f,e,function(f,a,e,l){l||f?(m=f,n=l,q.close()):
p(c,e,d,function(){h(new b(e,d,q),a);C(a+1)})})})(a)}}}var d=m("./stream"),e={current:1,ascending:function(){return e.current++}};a.prototype.onchange=function(){if(this.cloned){var c={},b;for(b in this.nodedata)c[b]=this.nodedata[b].clone();for(var f in this.pending);this.nodedata=c;this.cloned=!1}};a.KeyValue=function(c){var b=c||{};this.set=function(c,a){return b[c]=a};this.get=function(c){return b[c]};this.clone=function(c){var d={},e;for(e in b)d[e]=b[e];return c?d:new a.KeyValue(d)}};a.DefaultData=
function(){this.attr=new a.KeyValue;this.prop=new a.KeyValue;this.path=new a.KeyValue;this.tags=new a.KeyValue;this.text=new a.KeyValue;this.mark=new a.KeyValue};a.Root=function(c){c.detached=!0;this.execute=function(b,a){c.detached||g();h(c,b,e.ascending(),a)}};n.exports=a});t("src/parse",function(m,q,n){function a(a){this.original=a}a.tokenize=function(k,h){var p=0;return new a(k.match(h).map(function(a){var b={data:a,pos:p,assert:function(b,a){var c=this.data;if("name"===b){if(c.name||-1==="#:[]=!<>.*{}".indexOf(c[0]))return!0}else if(c===
b)return!0;if(a)return!1;throw Error(['Unexpected symbol "'+c+'" ','expected "'+b+'" ',"at column: "+this.pos].join(""));}};p+=a.length;return b}))};a.prototype.parse=function(k){var h,p=0,g=new a(this.original.map(function(b,a){if(!b)return b;var e=!1,c=k.call({setState:function(b){p=b},setCurrent:function(b){h=b},remove:function(){e=!0},expected:function(c,a){return b.assert(c,a)}},b.data,p,h);return e?null:{data:c,pos:b.pos,assert:b.assert}}));if(0<p)throw Error("Unexpected ending.");return g};
n.exports=function(k){var h=[[]];a.tokenize(k,/\#|\:|\[|\]|[\=\!<>]+|\{|\}|\*+|\.|[^\#\:\[\]\=\!<>\{\}\*\.]+/g).parse(function(a,g,b){var d;switch(g){case 0:if("*"===a[0]){d={wildcard:a.length};break}else if(this.expected("name",!0)){d={constant:a};break}else if("{"===a)this.setState(1);else return this.setCurrent(null),a;break;case 1:this.expected("{");this.setState(2);break;case 2:this.expected("name");d={breakets:a};this.setState(3);break;case 3:this.expected("}");this.setState(4);break;case 4:this.expected("}"),
this.setState(0)}if(b)this.remove(),d&&b.push(d);else return this.setCurrent(b=d?[d]:[]),{name:b}}).parse(function(a,g,b){var d;switch(g){case -1:if("["===a){this.setState(3);break}case 0:if(a.name)d={type:"_",name:a.name};else{switch(a){case ".":return a;case "#":this.setState(1);break;case ":":this.setState(2);break;case "[":this.setState(3);break;default:this.expected("#, : or [")}d={type:a}}break;case 1:case 2:this.expected("name");b.name=a.name;this.setState(1===g?0:-1);break;case 3:this.expected("name");
b.prop=a.name;this.setState(4);break;case 4:-1!=="=!<>".indexOf(a[0])?(b.assert=a,this.setState(5)):(this.expected("]"),this.setState(0));break;case 5:this.expected("name");b.value=a.name;this.setState(6);break;case 6:this.expected("]"),this.setState(0)}if(d)return this.setCurrent(d),d;this.remove()}).parse(function(a){"."===a?h.push([]):h[h.length-1].push(a)});return h}});t("src/query",function(m,q,n){function a(){this.root=null;this.traces=[]}function k(b,a,e,c,r){var f;switch(e){case "in":f=function(b,
a){return-1!==b.indexOf(a)};break;case "==":case "===":f=function(b,a){return b==a};break;case "!=":case "!==":f=function(b,a){return b!=a};break;case "<":f=function(b,a){return b<+a};break;case "<=":f=function(b,a){return b<=+a};break;case ">":f=function(b,a){return b>+a};break;case ">=":f=function(b,a){return b>=+a};break;case null:f=function(b,a){return b!==y};break;default:throw Error("Unknown operator "+e);}e=1===c.length&&c[0].breakets?r(c[0].breakets):e?h(c,r):null;return new g.Assertion(b,
a,f,e)}function h(b,a){var e="",c;for(c in b)if(b[c].breakets)e+=a(b[c].breakets);else if(b[c].constant)e+=b[c].constant;else if(b[c].wildcard)throw Error("* not supported here.");return e}function p(b,a){var e=[];b.map(function(b){if("_"===(b[0]||{}).type&&1===(b[0].name||{}).wildcard)e.push(g.Assertion.truthy);else{var a,f,d=null,l;switch(b.type){case "_":a="tags";f="name";d="==";l=b.name;break;case "#":a="attr";f="id";d="==";l=b.name;break;case "[":a="prop";f=b.prop;b.assert&&(d=b.assert,l=b.value);
break;case ":":b.prop?(a=b.name,f=b.prop,b.assert&&(d=b.assert,l=b.value)):(a="attr",f="class",d="in",l=b.name)}e.push(k(a,f,d,l))}});return new g.DNF(e)}m("./parse");var g=m("./state");a.buildStateMachine=function(b,a){var e;b.map(function(b){var a=new g.States;b.map(function(b,c){if(1===b.length&&"_"===(b[0]||{}).type&&2===(b[0].name||{}).wildcard){var e=g.Assertion.truthy;a.addTransition(c,c+1,e);a.addTransition(c,c,e)}else e=p(b),a.addTransition(c,c+1,e)});a.setEndState(b.length);e?e.or(a):e=
new g.DNF([a])});return e};a.prototype.get=function(){};a.prototype.has=function(){};a.prototype.from=function(){};a.prototype.each=function(){};a.prototype.live=function(){};n.exports=a});t("src/state",function(m,q,n){function a(a,g){this.terms=[{truthy:a||[],falsey:g||[]}]}function k(a,g,b,d){this.resolve=function(e){return b(d,e.get(a,g))}}function h(a,g,b){a=a||[0];g=g||{};b=b||{};this.addTransition=function(b,a,c){g[b]||(g[b]=[]);g[b].push({next:a,dnfa:c})};this.setEndState=function(a){b[a]=
!0};this.resolve=function(){for(var d=0;d<a.length;d++)if(b[a[d]])return!0;return!1};this.transition=function(d){if(0===a.length)return this;for(var e={},c=[],r=0;r<a.length;r++)for(var f=g[a[r]]||[],s=0;s<f.length;s++)if(f[s].dnfa.resolve(d)){var l=f[s].next;e[l]||(e[l]=!0,c.push(l))}return new h(c,g,b)}}a.prototype.or=function(h){h instanceof a||(h=new a([h]));this.terms=this.terms.concat(h.terms);return this};k.truthy={resolve:function(){return!0}};a.prototype.resolve=function(a){for(var g=!1,
b=0;b<this.terms.length;b++){for(var d=!0,e=this.terms[b].truthy,c=this.terms[b].falsey,r=0;r<e.length;r++)d&=e[r].resolve(a);for(e=0;e<c.length;e++)d&=!c[e].resolve(a);d&&(g=!0)}return g};a.prototype.transition=function(h){function g(a){for(var b=[],d=0;d<a.length;d++)b[d]=a[d].transition(h);return b}for(var b=new a,d=0;d<this.terms.length;d++)b.terms[d]={truthy:g(this.terms[d].truthy),falsey:g(this.terms[d].falsey)};return b};n.exports.States=h;n.exports.DNF=a;n.exports.Assertion=k});t("src/static",
function(m,q,n){function a(a,b){for(var f in a)a.hasOwnProperty(f)&&b(f,a[f],!1)}function k(a){return"string"!==typeof a&&"number"===typeof a.length}function h(a,b,f,e){for(var d=0;d<a.length;d++){var g=b.slice(0);g.push(d);f&&k(a[d])?h(a[d],g,f,e):e(g,a[d],!0)}}function p(b,g){function f(a,b,c){var f=p(b);f?(f.nodedata.tags.set(c?"index":"name",a),l.push(f)):s.prop.set(a,b)}var s=new e.DefaultData,l=[];if(k(b))s.tags.set("array",!0),h(b,[],g,f);else if(b.constructor===Object)a(b,f);else return null;
return new e(s,new d.Array(l))}function g(a,b,f,d){function e(a){g.length<=a+1?f[g[a]]=b:(f[g[a]]=[],e(a+1))}var g=a.get("tags","index");g&&"number"===typeof g[0]?e(0):d.push(b)}function b(a,d){var f=a.get("tags","array"),e=[],l=f?[]:{};a.find(0,null,function(a){b(a,function(b){if(f)g(a,b,l,e);else{var c=l,d=a.get("tags","name");d?c[d]=b:e.push(b)}})},function(){f&&(l=l.concat(e));var b=a.all("prop"),g;for(g in b)l[g]=b[g];d(l)})}var d=m("./stream"),e=m("./node");n.exports=function(a){a.read=function(a,
b){b||(b={});var c=b.type?b.type.toLowerCase():"";if(!c||"js"===c){c=p(a,!!b.flatten);if(!c)throw Error("Expected toplevel array or object.");return new e.Root(c)}};a.toJS=function(a,c){a.execute(function(a){b(a,function(a){c(a)})})}}});t("src/stream",function(m,q,n){function a(a){this.infinite=!!a}function k(a,d){this.original=a;this.extend=d}function h(a,d){this.original=a;this.stream=d}function p(a,d,e,c){this.reduced=new k(a,-d);this.count=e;this.fill=c}a.prototype.next=function(a,d,e){throw Error("Not implemented.");
};a.Array=function(a){!a||a instanceof Array||(a=[a]);this.elements=a||[]};a.Array.prototype=new a;a.Array.prototype.next=function(a,d,e){a>=this.elements.length?e(null,a,null,{length:this.elements.length}):(d=this.elements[a],this.mapper&&(d=this.mapper(d)),e(null,a,d))};k.prototype=new a;k.prototype.next=function(a,d,e){var c=this;this.original.next(a-this.extend,d,function(a,b,d,g){g&&(g.length+=c.extend);e(a,b+c.extend,d,g)})};(function(a,d){this.next=function(a,b,g){this.original.next(a,b,function(a,
b,c,e){c&&d(c);g(a,b,c,e)})}}).prototype=new a;h.prototype=new a;h.prototype.next=function(a,d,e){var c=this;this.original.next(a,d,function(g,f,h,l){if(g)return e(g);l?(c.offset||(c.offset=new k(c.stream,l.length)),c.offset.next(a,d,e)):e(g,f,h,null)})};p.prototype=new a;p.prototype.next=function(a,d,e){if(a>=this.count&&this.fill)return e(null,null,null,{length:this.count});var c=this;this.reduced.next(a,d,function(a,b,d,g){if(a)return e(a);(!g||c.fill)&&b>=c.count?e(a,null,null,{length:c.count}):
c.fill&&g?e(a,b,y,null):e(a,b,d,g)})};var g=Number.POSITIVE_INFINITY;a.prototype.append=function(b){b instanceof a||(b=new a.Array(b));return new h(this,b)};a.prototype.map=function(b){return new a.Mapper(this,b)};a.prototype.prepend=function(b,d){d instanceof a||(d=new a.Array(d));var e=new p(this,0,b,!0),c=new p(this,b,g);return new h(e,new h(d,c))};a.prototype.detach=function(a,d){var e=new p(this,0,a,!0),c=new p(this,a+d,g);return{target:new h(e,c),result:new p(this,a,d)}};n.exports=a});u.require("src/static")(u)})(Function("return this")());
