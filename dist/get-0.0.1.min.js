(function(w,z){function r(l,p){var n=l.replace(/\/index$/,"");n!==l&&(x[n]=l);u[l]=u[n]=p}function y(l){if(!v[l]){var p="Could not load module: '"+l+"'";if(!u[l])throw Error(p);p={exports:v[l]={}};u[l](function(n){var a=x[l]||l,k=/(\.?\.\/?)*/.exec(n)[0],m=Math.floor(k.replace(/\//g,"").length/1.9+0.99);m&&(a=a.split("/"),a=a.slice(0,a.length-m),(a=a.join("/"))&&(n=a+"/"+n.slice(k.length)));n=n.replace(/\/$/,"");return y(n)},p.exports,p);v[l]=p.exports}return v[l]}function s(){}var v={},u={},x={};
r("src/curry",function(l,p,n){function a(m,e){var f=!1,b=function(){var c=Array.prototype.slice.call(arguments,0),b=this,d=[],q=!1;if(!f){for(var h=0;h<c.length;h++)k.equals(c[h])&&d.push(h);q=k.equals(c[c.length-1])}return 0===d.length||f?m.apply(b,c):a(function(){var h=Array.prototype.slice.call(arguments,0),a=d.length-(q?1:0);if(h.length<a)throw Error("Expect at least "+a+" arguments.");q&&c.pop();for(var e=0;e<h.length;e++)e<a?c[d[e]]=h[e]:c.push(h[e]);return m.apply(b,c)},!0)};b.uncurry=function(){if(!e)throw"Uncurry disabled.";
f=!0;return this};return b}var k=(w._||(w._={})).runid={equals:function(a){return a&&this===a.runid}};n.exports=a});s.define=r;s.require=y;"undefined"===typeof exports?window.get=s:module.exports=s;r("src/node",function(l,p,n){function a(d,b,h){this.children=b||new c.Array;this.nodedata=d||new a.DefaultData;this.timestamp=0;this.pending=[];this.detached=h||!1;this.creation=g.ascending()}function k(d){var b=0,c=this;this.start=function(){b++};this.close=function(){0<b&&b--;0===b&&(b=-1,d&&d())};this.branch=
function(d){var b=new k(function(){d&&d();c.close()});this.start();b.expired=this.expired;return b};this.expired=function(){return 0>b}}function m(d,c,h,a){a=new k(a);a.start();if(d.timestamp<h){d.timestamp=h;var e=new b(d,h,a);(c=c(e,d))&&d.pending.push({timestamp:h,operation:c})}a.close()}function e(d,b,c,a){(function A(e){var g=d.pending[e]||{},f=g.timestamp>c;d.pending.length<=e||f?a():m(b,g.operation,g.timestamp,function(){A(e+1)})})(0)}function f(){throw Error("This reference has expired.");
}function b(d,c,h){this.clone=function(){function b(d,h){var e=!c;h.cloned=!0;e=new a(h.nodedata,h.children,e);e.pending=h.pending;e.cloned=!0;c=e;return b}h.expired()&&f();var c;m(d,b,g.ascending(),function(){});return new Root(c)};this.isRoot=function(){h.expired()&&f();return d.detached};this.isInfinite=function(){h.expired()&&f();return!!(d.children||{}).infinite};this.set=function(b,c,e){h.expired()&&f();if(!d.nodedata[b])throw Error("Unknown type.");return d.nodedata[b].set(c,e)};this.get=function(b,
c){h.expired()&&f();if(!d.nodedata[b])throw Error("Unknown type.");return d.nodedata[b].get(c)};this.all=function(b){h.expired()&&f();if(!d.nodedata[b])throw Error("Unknown type.");return d.nodedata[b].clone(!0)};this.next=function(a,g,k,m){h.expired()&&f();h.start();var l,n,p=h.branch(function(){m&&m(l,n);h.close()});p.start();d.children.next(a,g,function(h,a,g,f){f||h?(l=h,n=f,p.close()):e(d,g,c,function(){k(new b(g,c,p),a);p.close()})})};this.find=function(a,g,m,k){h.expired()&&f();if(this.isInfinite())k&&
k(null,{length:0});else{h.start();var l,n,p=h.branch(function(){k&&k(l,n);h.close()});p.start();(function B(h){d.children.next(h,g,function(h,a,g,f){f||h?(l=h,n=f,p.close()):e(d,g,c,function(){m(new b(g,c,p),a);B(a+1)})})})(a)}}}var c=l("./stream"),g={current:1,ascending:function(){return g.current++}};a.prototype.onchange=function(){if(this.cloned){var b={},c;for(c in this.nodedata)b[c]=this.nodedata[c].clone();for(var h in this.pending);this.nodedata=b;this.cloned=!1}};a.KeyValue=function(b){var c=
b||{};this.set=function(b,d){return c[b]=d};this.get=function(b){return c[b]};this.clone=function(b){var d={},e;for(e in c)d[e]=c[e];return b?d:new a.KeyValue(d)}};a.DefaultData=function(){this.attr=new a.KeyValue;this.prop=new a.KeyValue;this.path=new a.KeyValue;this.tags=new a.KeyValue;this.text=new a.KeyValue;this.mark=new a.KeyValue};a.Root=function(b){b.detached=!0;this.execute=function(c,h){b.detached||f();m(b,c,g.ascending(),h)}};n.exports=a});r("src/parse",function(l,p,n){function a(a){this.original=
a}a.tokenize=function(k,m){var e=0;return new a(k.match(m).map(function(a){var b={data:a,pos:e,assert:function(b,a){var d=this.data;if("name"===b){if(d.name||-1==="#:[]=!<>.*{}".indexOf(d[0]))return!0}else if(d===b)return!0;if(a)return!1;throw Error(['Unexpected symbol "'+d+'" ','expected "'+b+'" ',"at column: "+this.pos].join(""));}};e+=a.length;return b}))};a.prototype.parse=function(k){var m,e=0,f=new a(this.original.map(function(b,c){if(!b)return b;var a=!1,d=k.call({setState:function(b){e=b},
setCurrent:function(b){m=b},remove:function(){a=!0},expected:function(c,d){return b.assert(c,d)}},b.data,e,m);return a?null:{data:d,pos:b.pos,assert:b.assert}}));if(0<e)throw Error("Unexpected ending.");return f};n.exports=function(k){var m=[[]];a.tokenize(k,/\#|\:|\[|\]|[\=\!<>]+|\{|\}|\*+|\.|[^\#\:\[\]\=\!<>\{\}\*\.]+/g).parse(function(a,f,b){var c;switch(f){case 0:if("*"===a[0]){c={wildcard:a.length};break}else if(this.expected("name",!0)){c={constant:a};break}else if("{"===a)this.setState(1);
else return this.setCurrent(null),a;break;case 1:this.expected("{");this.setState(2);break;case 2:this.expected("name");c={breakets:a};this.setState(3);break;case 3:this.expected("}");this.setState(4);break;case 4:this.expected("}"),this.setState(0)}if(b)this.remove(),c&&b.push(c);else return this.setCurrent(b=c?[c]:[]),{name:b}}).parse(function(a,f,b){var c;switch(f){case -1:if("["===a){this.setState(3);break}case 0:if(a.name)c={type:"_",name:a.name};else{switch(a){case ".":return a;case "#":this.setState(1);
break;case ":":this.setState(2);break;case "[":this.setState(3);break;default:this.expected("#, : or [")}c={type:a}}break;case 1:case 2:this.expected("name");b.name=a.name;this.setState(1===f?0:-1);break;case 3:this.expected("name");b.prop=a.name;this.setState(4);break;case 4:-1!=="=!<>".indexOf(a[0])?(b.assert=a,this.setState(5)):(this.expected("]"),this.setState(0));break;case 5:this.expected("name");b.value=a.name;this.setState(6);break;case 6:this.expected("]"),this.setState(0)}if(c)return this.setCurrent(c),
c;this.remove()}).parse(function(a){"."===a?m.push([]):m[m.length-1].push(a)});return m}});r("src/query",function(l,p,n){function a(){this.root=this.traces=[]}l("./parse");var k=l("./state");a.buildStateMachine=function(a){function e(b,a){return b===a}function f(b,a){var d=[];b.map(function(b){switch(b.type){case "_":1===b.name.length&&b.name[0].constant?d.push(new k.Assertion("tags","name",e,b.name[0].constant)):1===b.name.wildcard&&d.push(k.Assertion.truthy)}});return new k.DNF(d)}var b;a.map(function(a){var e=
new k.States;a.map(function(b,a){var c;c=1===b.length&&"_"===(b[0]||{}).type?2===(b[0].name||{}).wildcard:!1;c?(c=k.Assertion.truthy,e.addTransition(a,a+1,c),e.addTransition(a,a,c)):(c=f(b),e.addTransition(a,a+1,c))});e.setEndState(a.length);b?b.or(e):b=new k.DNF([e])});return b};a.prototype.get=function(){};a.prototype.has=function(){};a.prototype.from=function(){};a.prototype.each=function(){};a.prototype.live=function(){};n.exports=a});r("src/state",function(l,p,n){function a(a,f){this.terms=[{truthy:a||
[],falsey:f||[]}]}function k(a,f,b,c){this.resolve=function(g){return b(c,g.get(a,f))}}function m(a,f,b){a=a||[0];f=f||{};b=b||{};this.addTransition=function(b,a,d){f[b]||(f[b]=[]);f[b].push({next:a,dnfa:d})};this.setEndState=function(a){b[a]=!0};this.resolve=function(){for(var c=0;c<a.length;c++)if(b[a[c]])return!0;return!1};this.transition=function(c){if(0===a.length)return this;for(var g={},d=[],q=0;q<a.length;q++)for(var h=f[a[q]]||[],k=0;k<h.length;k++)if(h[k].dnfa.resolve(c)){var t=h[k].next;
g[t]||(g[t]=!0,d.push(t))}return new m(d,f,b)}}a.prototype.or=function(e){e instanceof a||(e=new a([e]));this.terms=this.terms.concat(e.terms);return this};k.truthy={resolve:function(){return!0}};a.prototype.resolve=function(a){for(var f=!1,b=0;b<this.terms.length;b++){for(var c=!0,g=this.terms[b].truthy,d=this.terms[b].falsey,q=0;q<g.length;q++)c&=g[q].resolve(a);for(g=0;g<d.length;g++)c&=!d[g].resolve(a);c&&(f=!0)}return f};a.prototype.transition=function(e){function f(b){for(var a=[],c=0;c<b.length;c++)a[c]=
b[c].transition(e);return a}for(var b=new a,c=0;c<this.terms.length;c++)b.terms[c]={truthy:f(this.terms[c].truthy),falsey:f(this.terms[c].falsey)};return b};n.exports.States=m;n.exports.DNF=a;n.exports.Assertion=k});r("src/static",function(l,p,n){function a(b,a){for(var c in b)b.hasOwnProperty(c)&&a(c,b[c],!1)}function k(b){return"string"!==typeof b&&"number"===typeof b.length}function m(b,a,c,e){for(var g=0;g<b.length;g++){var f=a.slice(0);f.push(g);c&&k(b[g])?m(b[g],f,c,e):e(f,b[g],!0)}}function e(b,
f){function h(b,a,c){var d=e(a);d?(d.nodedata.tags.set(c?"index":"name",b),t.push(d)):l.prop.set(b,a)}var l=new g.DefaultData,t=[];if(k(b))l.tags.set("array",!0),m(b,[],f,h);else if(b.constructor===Object)a(b,h);else return null;return new g(l,new c.Array(t))}function f(b,a,c,e){function g(b){f.length<=b+1?c[f[b]]=a:(c[f[b]]=[],g(b+1))}var f=b.get("tags","index");f&&"number"===typeof f[0]?g(0):e.push(a)}function b(a,c){var h=a.get("tags","array"),e=[],g=h?[]:{};a.find(0,null,function(a){b(a,function(b){if(h)f(a,
b,g,e);else{var c=g,d=a.get("tags","name");d?c[d]=b:e.push(b)}})},function(){h&&(g=g.concat(e));var b=a.all("prop"),f;for(f in b)g[f]=b[f];c(g)})}var c=l("./stream"),g=l("./node");n.exports=function(a){a.read=function(b,a){a||(a={});var c=a.type?a.type.toLowerCase():"";if(!c||"js"===c){c=e(b,!!a.flatten);if(!c)throw Error("Expected toplevel array or object.");return new g.Root(c)}};a.toJS=function(a,c){a.execute(function(a){b(a,function(b){c(b)})})}}});r("src/stream",function(l,p,n){function a(b){this.infinite=
!!b}function k(b,a){this.original=b;this.extend=a}function m(b,a){this.original=b;this.stream=a}function e(b,a,g,d){this.reduced=new k(b,-a);this.count=g;this.fill=d}a.prototype.next=function(b,a,g){throw Error("Not implemented.");};a.Array=function(b){!b||b instanceof Array||(b=[b]);this.elements=b||[]};a.Array.prototype=new a;a.Array.prototype.next=function(b,a,g){b>=this.elements.length?g(null,b,null,{length:this.elements.length}):(a=this.elements[b],this.mapper&&(a=this.mapper(a)),g(null,b,a))};
k.prototype=new a;k.prototype.next=function(a,c,g){var d=this;this.original.next(a-this.extend,c,function(a,b,c,e){e&&(e.length+=d.extend);g(a,b+d.extend,c,e)})};(function(a,c){this.next=function(a,b,e){this.original.next(a,b,function(a,b,d,g){d&&c(d);e(a,b,d,g)})}}).prototype=new a;m.prototype=new a;m.prototype.next=function(a,c,e){var d=this;this.original.next(a,c,function(f,h,m,l){if(f)return e(f);l?(d.offset||(d.offset=new k(d.stream,l.length)),d.offset.next(a,c,e)):e(f,h,m,null)})};e.prototype=
new a;e.prototype.next=function(a,c,e){if(a>=this.count&&this.fill)return e(null,null,null,{length:this.count});var d=this;this.reduced.next(a,c,function(a,b,c,f){if(a)return e(a);(!f||d.fill)&&b>=d.count?e(a,null,null,{length:d.count}):d.fill&&f?e(a,b,z,null):e(a,b,c,f)})};var f=Number.POSITIVE_INFINITY;a.prototype.append=function(b){b instanceof a||(b=new a.Array(b));return new m(this,b)};a.prototype.map=function(b){return new a.Mapper(this,b)};a.prototype.prepend=function(b,c){c instanceof a||
(c=new a.Array(c));var g=new e(this,0,b,!0),d=new e(this,b,f);return new m(g,new m(c,d))};a.prototype.detach=function(a,c){var g=new e(this,0,a,!0),d=new e(this,a+c,f);return{target:new m(g,d),result:new e(this,a,c)}};n.exports=a});s.require("src/static")(s)})(Function("return this")());
