(function(u,v,x){var s={},t={},w={},q=u.define=function(l,p){var n=l.replace(/\/index$/,"");n!==l&&(w[n]=l);t[l]=t[n]=p},y=u.require=function(l){if(!s[l]){var p="Could not load module: '"+l+"'";if(!t[l])throw Error(p);p={exports:s[l]={}};t[l](function(n){var a=y,g=w[l]||l,m=/(\.?\.\/?)*/.exec(n)[0],d=Math.floor(m.replace(/\//g,"").length/1.9+0.99);d&&(g=g.split("/"),g=g.slice(0,g.length-d),(g=g.join("/"))&&(n=g+"/"+n.slice(m.length)));n=n.replace(/\/$/,"");return a(n)},p.exports,p);s[l]=p.exports}return s[l]};
q("src/curry",function(l,p,n){function a(m,d){var e=!1,b=function(){var c=Array.prototype.slice.call(arguments,0),b=this,f=[],r=!1;if(!e){for(var h=0;h<c.length;h++)g.equals(c[h])&&f.push(h);r=g.equals(c[c.length-1])}return 0===f.length||e?m.apply(b,c):a(function(){var h=Array.prototype.slice.call(arguments,0),d=f.length-(r?1:0);if(h.length<d)throw Error("Expect at least "+d+" arguments.");r&&c.pop();for(var a=0;a<h.length;a++)a<d?c[f[a]]=h[a]:c.push(h[a]);return m.apply(b,c)},!0)};b.uncurry=function(){if(!d)throw"Uncurry disabled.";
e=!0;return this};return b}var g=(v._||(v._={})).runid={equals:function(a){return a&&this===a.runid}};n.exports=a});q("src/index",function(l,p,n){});q("src/node",function(l,p,n){function a(f,b,h){this.children=b||new c.Array;this.nodedata=f||new a.DefaultData;this.timestamp=0;this.pending=[];this.detached=h||!1;this.creation=k.ascending()}function g(f){var b=0,c=this;this.start=function(){b++};this.close=function(){0<b&&b--;0===b&&(b=-1,f&&f())};this.branch=function(b){var f=new g(function(){b&&b();
c.close()});this.start();f.expired=this.expired;return f};this.expired=function(){return 0>b}}function m(f,c,h,d){d=new g(d);d.start();if(f.timestamp<h){f.timestamp=h;var a=new b(f,h,d);(c=c(a,f))&&f.pending.push({timestamp:h,operation:c})}d.close()}function d(b,c,d,a){(function z(k){var e=b.pending[k]||{},g=e.timestamp>d;b.pending.length<=k||g?a():m(c,e.operation,e.timestamp,function(){z(k+1)})})(0)}function e(){throw Error("This reference has expired.");}function b(c,r,h){this.clone=function(){function b(c,
f){var h=!d;f.cloned=!0;h=new a(f.nodedata,f.children,h);h.pending=f.pending;h.cloned=!0;d=h;return b}h.expired()&&e();var d;m(c,b,k.ascending(),function(){});return new Root(d)};this.isRoot=function(){h.expired()&&e();return c.detached};this.isInfinite=function(){h.expired()&&e();return!!(c.children||{}).infinite};this.set=function(b,d,a){h.expired()&&e();if(!c.nodedata[b])throw Error("Unknown type.");return c.nodedata[b].set(d,a)};this.get=function(b,d){h.expired()&&e();if(!c.nodedata[b])throw Error("Unknown type.");
return c.nodedata[b].get(d)};this.all=function(b){h.expired()&&e();if(!c.nodedata[b])throw Error("Unknown type.");return c.nodedata[b].clone(!0)};this.next=function(a,k,g,m){h.expired()&&e();h.start();var l,n,p=h.branch(function(){m&&m(l,n);h.close()});p.start();c.children.next(a,k,function(h,a,k,e){e||h?(l=h,n=e,p.close()):d(c,k,r,function(){g(a,new b(k,r,p));p.close()})})};this.find=function(a,k,g,m){h.expired()&&e();if(this.isInfinite())return m(null,{length:0});h.start();var l,n,p=h.branch(function(){m&&
m(l,n);h.close()});p.start();(function A(a){c.children.next(a,k,function(a,h,k,e){e||a?(l=a,n=e,p.close()):d(c,k,r,function(){g(h,new b(k,r,p));A(h+1)})})})(a)}}var c=l("./stream"),k={current:1,ascending:function(){return k.current++}};a.prototype.onchange=function(){if(this.cloned){var b={},c;for(c in this.nodedata)b[c]=this.nodedata[c].clone();for(var d in this.pending);this.nodedata=b;this.cloned=!1}};a.KeyValue=function(b){var c=b||{};this.set=function(b,d){return c[b]=d};this.get=function(b){return c[b]};
this.clone=function(b){var d={},f;for(f in c)d[f]=c[f];return b?d:new a.KeyValue(d)}};a.DefaultData=function(){this.attr=new a.KeyValue;this.prop=new a.KeyValue;this.path=new a.KeyValue;this.tags=new a.KeyValue;this.text=new a.KeyValue;this.mark=new a.KeyValue};a.Root=function(b){this.execute=function(c,d){b.detached||e();m(b,c,k.ascending(),d)}};n.exports=a});q("src/parse",function(l,p,n){function a(a){this.original=a}a.tokenize=function(g,m){var d=0;return new a(g.match(m).map(function(a){var b=
{data:a,pos:d,assert:function(b,d){var a=this.data;if("name"===b){if(a.name||-1==="#:[]=!<>.*{}".indexOf(a[0]))return!0}else if(a===b)return!0;if(d)return!1;throw Error(['Unexpected symbol "'+a+'" ','expected "'+b+'" ',"at column: "+this.pos].join(""));}};d+=a.length;return b}))};a.prototype.parse=function(g){var m,d=0,e=new a(this.original.map(function(b,c){if(!b)return b;var a=!1,f=g.call({setState:function(b){d=b},setCurrent:function(b){m=b},remove:function(){a=!0},expected:function(c,a){return b.assert(c,
a)}},b.data,d,m);return a?null:{data:f,pos:b.pos,assert:b.assert}}));if(0<d)throw Error("Unexpected ending.");return e};n.exports=function(g){var m=[[]];a.tokenize(g,/\#|\:|\[|\]|[\=\!<>]+|\{|\}|\*+|\.|[^\#\:\[\]\=\!<>\{\}\*\.]+/g).parse(function(a,e,b){var c;switch(e){case 0:if("*"===a[0]){c={wildcard:a.length};break}else if(this.expected("name",!0)){c={constant:a};break}else if("{"===a)this.setState(1);else return this.setCurrent(null),a;break;case 1:this.expected("{");this.setState(2);break;case 2:this.expected("name");
c={breakets:a};this.setState(3);break;case 3:this.expected("}");this.setState(4);break;case 4:this.expected("}"),this.setState(0)}if(b)this.remove(),c&&b.push(c);else return this.setCurrent(b=c?[c]:[]),{name:b}}).parse(function(a,e,b){var c;switch(e){case -1:if("["===a){this.setState(3);break}case 0:if(a.name)c={type:"_",name:a.name};else{switch(a){case ".":return a;case "#":this.setState(1);break;case ":":this.setState(2);break;case "[":this.setState(3);break;default:this.expected("#, : or [")}c=
{type:a}}break;case 1:case 2:this.expected("name");b.name=a.name;this.setState(1===e?0:-1);break;case 3:this.expected("name");b.prop=a.name;this.setState(4);break;case 4:-1!=="=!<>".indexOf(a[0])?(b.assert=a,this.setState(5)):(this.expected("]"),this.setState(0));break;case 5:this.expected("name");b.value=a.name;this.setState(6);break;case 6:this.expected("]"),this.setState(0)}if(c)return this.setCurrent(c),c;this.remove()}).parse(function(a){"."===a?m.push([]):m[m.length-1].push(a)});return m}});
q("src/query",function(l,p,n){function a(){this.root=this.traces=[]}l("./parse");var g=l("./state");a.buildStateMachine=function(a){function d(b,a){return b===a}function e(b,a){var f=[];b.map(function(b){switch(b.type){case "_":1===b.name.length&&b.name[0].constant?f.push(new g.Assertion("tags","name",d,b.name[0].constant)):1===b.name.wildcard&&f.push(g.Assertion.truthy)}});return new g.DNF(f)}var b;a.map(function(a){var d=new g.States;a.map(function(b,a){var c;c=1===b.length&&"_"===(b[0]||{}).type?
2===(b[0].name||{}).wildcard:!1;c?(c=g.Assertion.truthy,d.addTransition(a,a+1,c),d.addTransition(a,a,c)):(c=e(b),d.addTransition(a,a+1,c))});d.setEndState(a.length);b?b.or(d):b=new g.DNF([d])});return b};a.prototype.get=function(){};a.prototype.has=function(){};a.prototype.from=function(){};a.prototype.each=function(){};a.prototype.live=function(){};n.exports=a});q("src/state",function(l,p,n){function a(a,e){this.terms=[{truthy:a||[],falsey:e||[]}]}function g(a,e,b,c){this.resolve=function(k){return b(c,
k.get(a,e))}}function m(a,e,b){a=a||[0];e=e||{};b=b||{};this.addTransition=function(b,a,f){e[b]||(e[b]=[]);e[b].push({next:a,dnfa:f})};this.setEndState=function(a){b[a]=!0};this.resolve=function(){for(var c=0;c<a.length;c++)if(b[a[c]])return!0;return!1};this.transition=function(c){if(0===a.length)return this;for(var k={},f=[],g=0;g<a.length;g++)for(var h=e[a[g]]||[],l=0;l<h.length;l++)if(h[l].dnfa.resolve(c)){var n=h[l].next;k[n]||(k[n]=!0,f.push(n))}return new m(f,e,b)}}a.prototype.or=function(d){d instanceof
a||(d=new a([d]));this.terms=this.terms.concat(d.terms);return this};g.truthy={resolve:function(){return!0}};a.prototype.resolve=function(a){for(var e=!1,b=0;b<this.terms.length;b++){for(var c=!0,k=this.terms[b].truthy,f=this.terms[b].falsey,g=0;g<k.length;g++)c&=k[g].resolve(a);for(k=0;k<f.length;k++)c&=!f[k].resolve(a);c&&(e=!0)}return e};a.prototype.transition=function(d){function e(b){for(var a=[],c=0;c<b.length;c++)a[c]=b[c].transition(d);return a}for(var b=new a,c=0;c<this.terms.length;c++)b.terms[c]=
{truthy:e(this.terms[c].truthy),falsey:e(this.terms[c].falsey)};return b};n.exports.States=m;n.exports.DNF=a;n.exports.Assertion=g});q("src/static",function(l,p,n){var a=l("./child");get.json=function(g,m){function d(c){function k(b,a,c){var f=d(a);f?(f.tags[c]=b,g.push(f)):h.prop[b]=a}var h=new InternalNode,g=[];if("number"===typeof c.length)h.tags.array=!0,b(c,[],k);else if(c.constructor===Object)e(c,k);else return null;h.children=new a(g);return h}function e(b,a){for(var c in b)b.hasOwnProperty(c)&&
a(c,b[c],"name")}function b(a,d,h){for(var k=0;k<a.length;k++){var e=d.slice(0).push(k);c&&a[k].length?b(a[k],e,h):h(e,a[k],"index")}}var c=(m||{}).flatten,k=d(g);if(!k)throw Error("Expected toplevel array or object.");k.tags.root=!0;return k}});q("src/stream",function(l,p,n){function a(a){this.infinite=!!a}function g(a,c){this.original=a;this.extend=c}function m(a,c){this.original=a;this.stream=c}function d(a,c,d,f){this.reduced=new g(a,-c);this.count=d;this.fill=f}a.prototype.next=function(a,c,
d){throw Error("Not implemented.");};a.Array=function(a){!a||a instanceof Array||(a=[a]);this.elements=a||[]};a.Array.prototype=new a;a.Array.prototype.next=function(a,c,d){a>=this.elements.length?d(null,a,null,{length:this.elements.length}):(c=this.elements[a],this.mapper&&(c=this.mapper(c)),d(null,a,c))};g.prototype=new a;g.prototype.next=function(a,c,d){var f=this;this.original.next(a-this.extend,c,function(a,b,c,e){e&&(e.length+=f.extend);d(a,b+f.extend,c,e)})};(function(a,c){this.next=function(a,
b,d){this.original.next(a,b,function(a,b,f,e){f&&c(f);d(a,b,f,e)})}}).prototype=new a;m.prototype=new a;m.prototype.next=function(a,c,d){var f=this;this.original.next(a,c,function(e,h,m,l){if(e)return d(e);l?(f.offset||(f.offset=new g(f.stream,l.length)),f.offset.next(a,c,d)):d(e,h,m,null)})};d.prototype=new a;d.prototype.next=function(a,c,d){if(a>=this.count&&this.fill)return d(null,null,null,{length:this.count});var e=this;this.reduced.next(a,c,function(a,b,c,g){if(a)return d(a);(!g||e.fill)&&b>=
e.count?d(a,null,null,{length:e.count}):e.fill&&g?d(a,b,x,null):d(a,b,c,g)})};var e=Number.POSITIVE_INFINITY;a.prototype.append=function(b){b instanceof a||(b=new a.Array(b));return new m(this,b)};a.prototype.map=function(b){return new a.Mapper(this,b)};a.prototype.prepend=function(b,c){c instanceof a||(c=new a.Array(c));var g=new d(this,0,b,!0),f=new d(this,b,e);return new m(g,new m(c,f))};a.prototype.detach=function(a,c){var g=new d(this,0,a,!0),f=new d(this,a+c,e);return{target:new m(g,f),result:new d(this,
a,c)}};n.exports=a});u.require("src")})("undefined"===typeof exports?window.run={}:exports,Function("return this")());
