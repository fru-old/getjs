(function(u,w,y){var s={},t={},x={},q=u.define=function(h,n){var k=h.replace(/\/index$/,"");k!==h&&(x[k]=h);t[h]=t[k]=n},z=u.require=function(h){if(!s[h]){var n="Could not load module: '"+h+"'";if(!t[h])throw Error(n);n={exports:s[h]={}};t[h](function(k){var a=z,g=x[h]||h,f=/(\.?\.\/?)*/.exec(k)[0],b=Math.floor(f.replace(/\//g,"").length/1.9+0.99);b&&(g=g.split("/"),g=g.slice(0,g.length-b),(g=g.join("/"))&&(k=g+"/"+k.slice(f.length)));k=k.replace(/\/$/,"");return a(k)},n.exports,n);s[h]=n.exports}return s[h]};
q("src/curry",function(h,n,k){function a(f,b){var d=!1,e=function(){var c=Array.prototype.slice.call(arguments,0),b=this,e=[],r=!1;if(!d){for(var m=0;m<c.length;m++)g.equals(c[m])&&e.push(m);r=g.equals(c[c.length-1])}return 0===e.length||d?f.apply(b,c):a(function(){var a=Array.prototype.slice.call(arguments,0),d=e.length-(r?1:0);if(a.length<d)throw Error("Expect at least "+d+" arguments.");r&&c.pop();for(var m=0;m<a.length;m++)m<d?c[e[m]]=a[m]:c.push(a[m]);return f.apply(b,c)},!0)};e.uncurry=function(){if(!b)throw"Uncurry disabled.";
d=!0;return this};return e}var g=(w._||(w._={})).runid={equals:function(a){return a&&this===a.runid}};k.exports=a});q("src/index",function(h,n,k){});q("src/node",function(h,n,k){function a(b,d,e){this.children=d||new g.Array;this.nodedata=b||new a.DefaultData;this.timestamp=f.ascending();this.pending=[];this.detached=e||!1;this.creation=f.ascending()}var g=h("./stream"),f={current:1,ascending:function(){return f.current++}};a.prototype.onchange=function(){if(this.cloned){var b={},a;for(a in this.nodedata)b[a]=
this.nodedata[a].clone();for(var e in this.pending);this.nodedata=b;this.cloned=!1}};a.KeyValue=function(b){var d=b||{};this.set=function(b,c){return d[b]=c};this.get=function(b){return d[b]};this.clone=function(b){var c={},l;for(l in d)c[l]=d[l];return b?c:new a.KeyValue(c)}};a.DefaultData=function(){this.attr=new a.KeyValue;this.prop=new a.KeyValue;this.path=new a.KeyValue;this.tags=new a.KeyValue;this.text=new a.KeyValue;this.mark=new a.KeyValue};a.Root=function(b){this.execute=function(b,a){}};
a.Root=function(b){this._stream=b}});q("src/parse",function(h,n,k){function a(a){this.original=a}a.tokenize=function(g,f){var b=0;return new a(g.match(f).map(function(a){var e={data:a,pos:b,assert:function(c,b){var a=this.data;if("name"===c){if(a.name||-1==="#:[]=!<>.*{}".indexOf(a[0]))return!0}else if(a===c)return!0;if(b)return!1;throw Error(['Unexpected symbol "'+a+'" ','expected "'+c+'" ',"at column: "+this.pos].join(""));}};b+=a.length;return e}))};a.prototype.parse=function(g){var f,b=0,d=new a(this.original.map(function(a,
c){if(!a)return a;var l=!1,p=g.call({setState:function(c){b=c},setCurrent:function(c){f=c},remove:function(){l=!0},expected:function(c,b){return a.assert(c,b)}},a.data,b,f);return l?null:{data:p,pos:a.pos,assert:a.assert}}));if(0<b)throw Error("Unexpected ending.");return d};n.parse=function(g){var f=[[]];a.tokenize(g,/\#|\:|\[|\]|[\=\!<>]+|\{|\}|\*+|\.|[^\#\:\[\]\=\!<>\{\}\*\.]+/g).parse(function(b,a,e){var c;switch(a){case 0:if("*"===b[0]){c={wildcard:b.length};break}else if(this.expected("name",
!0)){c={constant:b};break}else if("{"===b)this.setState(1);else return this.setCurrent(null),b;break;case 1:this.expected("{");this.setState(2);break;case 2:this.expected("name");c={breakets:b};this.setState(3);break;case 3:this.expected("}");this.setState(4);break;case 4:this.expected("}"),this.setState(0)}if(e)this.remove(),c&&e.push(c);else return this.setCurrent(e=c?[c]:[]),{name:e}}).parse(function(a,f,e){var c;switch(f){case -1:if("["===a){this.setState(3);break}case 0:if(a.name)c={type:"_",
name:a.name};else{switch(a){case ".":return a;case "#":this.setState(1);break;case ":":this.setState(2);break;case "[":this.setState(3);break;default:this.expected("#, : or [")}c={type:a}}break;case 1:case 2:this.expected("name");e.name=a.name;this.setState(1===f?0:-1);break;case 3:this.expected("name");e.prop=a.name;this.setState(4);break;case 4:-1!=="=!<>".indexOf(a[0])?(e.assert=a,this.setState(5)):(this.expected("]"),this.setState(0));break;case 5:this.expected("name");e.value=a.name;this.setState(6);
break;case 6:this.expected("]"),this.setState(0)}if(c)return this.setCurrent(c),c;this.remove()}).parse(function(a){"."===a?f.push([]):f[f.length-1].push(a)});return f}});q("src/query",function(h,n,k){});q("src/state",function(h,n,k){function a(a,b){this.terms=[{truthy:a||[],falsey:b||[]}]}function g(a,b,d){a=a||[0];b=b||{};d=d||{};this.addTransition=function(a,c,l){b[a]||(b[a]=[]);b[a].push({next:c,dnfa:l})};this.setEndState=function(a){d[a]=!0};this.resolve=function(){for(var b=0;b<a.length;b++)if(d[a[b]])return!0;
return!1};this.transition=function(e){if(0===a.length)return this;for(var c={},l=[],p=0;p<a.length;p++)for(var r=b[a[p]]||[],m=0;m<r.length;m++)if(r[m].dnfa.resolve(e)){var v=r[m].next;c[v]||(c[v]=!0,l.push(v))}return new g(l,b,d)}}a.prototype.or=function(f){f instanceof a||(f=new a([f]));this.terms=this.terms.concat(f.terms);return this};a.prototype.resolve=function(a){for(var b=!1,d=0;d<this.terms.length;d++){for(var e=!0,c=this.terms[d].truthy,l=this.terms[d].falsey,p=0;p<c.length;p++)e&=c[p].resolve(a);
for(c=0;c<l.length;c++)e&=!l[c].resolve(a);e&&(b=!0)}return b};a.prototype.transition=function(f){function b(a){for(var b=[],p=0;p<a.length;p++)b[p]=a[p].transition(f);return b}for(var d=new a,e=0;e<this.terms.length;e++)d.terms[e]={truthy:b(this.terms[e].truthy),falsey:b(this.terms[e].falsey)};return d};k.exports.States=g;k.exports.DNF=a;k.exports.Assertion=function(a,b,d,e){this.resolve=function(c){return d(e,(c[a]||{})[b])}}});q("src/static",function(h,n,k){var a=h("./child");get.json=function(g,
f){function b(c){function l(a,c,p){var e=b(c);e?(e.tags[p]=a,f.push(e)):m.prop[a]=c}var m=new InternalNode,f=[];if("number"===typeof c.length)m.tags.array=!0,e(c,[],l);else if(c.constructor===Object)d(c,l);else return null;m.children=new a(f);return m}function d(a,c){for(var b in a)a.hasOwnProperty(b)&&c(b,a[b],"name")}function e(a,b,l){for(var d=0;d<a.length;d++){var f=b.slice(0).push(d);c&&a[d].length?e(a[d],f,l):l(f,a[d],"index")}}var c=(f||{}).flatten,l=b(g);if(!l)throw Error("Expected toplevel array or object.");
l.tags.root=!0;return l}});q("src/stream",function(h,n,k){function a(){}function g(a,b){this.original=a;this.extend=b}function f(a,b){this.original=a;this.result=[]}function b(a,b){this.original=a;this.stream=b}function d(a,b,d,e){this.reduced=new g(a,-b);this.count=d;this.fill=e}a.prototype.next=function(a,b,d,e){throw Error("Not implemented.");};a.Array=function(a){!a||a instanceof Array||(a=[a]);this.elements=a||[]};a.Array.prototype=new a;a.Array.prototype.next=function(a,b,d){a>=this.elements.length?
d(null,a,null,{length:this.elements.length}):(b=this.elements[a],this.mapper&&(b=this.mapper(b)),d(null,a,b))};g.prototype=new a;g.prototype.next=function(a,b,d){var e=this;this.original.next(a-this.extend,b,function(a,b,c,f){f&&(f.length+=e.extend);d(a,b+e.extend,c,f)})};f.prototype=new a;f.prototype.next=function(a,b,d){var e=this;this.original.next(a,b,function(a,b,c,f){c&&(e.result[b]||(e.result[b]=mapper(c)),c=e.result[b]);d(a,b,c,f)})};b.prototype=new a;b.prototype.next=function(a,b,d){var e=
this;this.original.next(a,b,function(f,h,k,n){if(f)return d(f);n?(e.offset||(e.offset=new g(e.stream,n.length)),e.offset.next(a,b,d)):d(f,h,k,null)})};d.prototype=new a;d.prototype.next=function(a,b,d){if(a>=this.count&&this.fill)return d(null,null,null,{length:this.count});var e=this;this.reduced.next(a,b,function(a,b,c,f){if(a)return d(a);(!f||e.fill)&&b>=e.count?d(a,null,null,{length:e.count}):e.fill&&f?d(a,b,y,null):d(a,b,c,f)})};var e=Number.POSITIVE_INFINITY;a.prototype.append=function(c){c instanceof
a||(c=new a.Array(c));return new b(this,c)};a.prototype.map=function(b){return new a.Mapper(this,b)};a.prototype.prepend=function(c,f){f instanceof a||(f=new a.Array(f));var g=new d(this,0,c,!0),h=new d(this,c,e);return new b(g,new b(f,h))};a.prototype.detach=function(a,f){var g=new d(this,0,a,!0),h=new d(this,a+f,e);return{target:new b(g,h),result:new d(this,a,f)}};k.exports=a});u.require("src")})("undefined"===typeof exports?window.run={}:exports,Function("return this")());
